== Parsed Logical Plan ==
CTE [year_total]
:  +- 'SubqueryAlias `year_total`
:     +- 'Union
:        :- 'Union
:        :  :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#0, 'c_first_name AS customer_first_name#1, 'c_last_name AS customer_last_name#2, 'c_preferred_cust_flag AS customer_preferred_cust_flag#3, 'c_birth_country AS customer_birth_country#4, 'c_login AS customer_login#5, 'c_email_address AS customer_email_address#6, 'd_year AS dyear#7, 'sum((((('ss_ext_list_price - 'ss_ext_wholesale_cost) - 'ss_ext_discount_amt) + 'ss_ext_sales_price) / 2)) AS year_total#8, s AS sale_type#9]
:        :  :  +- 'Filter (('c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk))
:        :  :     +- 'Join Inner
:        :  :        :- 'Join Inner
:        :  :        :  :- 'UnresolvedRelation `customer`
:        :  :        :  +- 'UnresolvedRelation `store_sales`
:        :  :        +- 'UnresolvedRelation `date_dim`
:        :  +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#10, 'c_first_name AS customer_first_name#11, 'c_last_name AS customer_last_name#12, 'c_preferred_cust_flag AS customer_preferred_cust_flag#13, 'c_birth_country AS customer_birth_country#14, 'c_login AS customer_login#15, 'c_email_address AS customer_email_address#16, 'd_year AS dyear#17, 'sum((((('cs_ext_list_price - 'cs_ext_wholesale_cost) - 'cs_ext_discount_amt) + 'cs_ext_sales_price) / 2)) AS year_total#18, c AS sale_type#19]
:        :     +- 'Filter (('c_customer_sk = 'cs_bill_customer_sk) && ('cs_sold_date_sk = 'd_date_sk))
:        :        +- 'Join Inner
:        :           :- 'Join Inner
:        :           :  :- 'UnresolvedRelation `customer`
:        :           :  +- 'UnresolvedRelation `catalog_sales`
:        :           +- 'UnresolvedRelation `date_dim`
:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#20, 'c_first_name AS customer_first_name#21, 'c_last_name AS customer_last_name#22, 'c_preferred_cust_flag AS customer_preferred_cust_flag#23, 'c_birth_country AS customer_birth_country#24, 'c_login AS customer_login#25, 'c_email_address AS customer_email_address#26, 'd_year AS dyear#27, 'sum((((('ws_ext_list_price - 'ws_ext_wholesale_cost) - 'ws_ext_discount_amt) + 'ws_ext_sales_price) / 2)) AS year_total#28, w AS sale_type#29]
:           +- 'Filter (('c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk))
:              +- 'Join Inner
:                 :- 'Join Inner
:                 :  :- 'UnresolvedRelation `customer`
:                 :  +- 'UnresolvedRelation `web_sales`
:                 +- 'UnresolvedRelation `date_dim`
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['t_s_secyear.customer_id ASC NULLS FIRST, 't_s_secyear.customer_first_name ASC NULLS FIRST, 't_s_secyear.customer_last_name ASC NULLS FIRST, 't_s_secyear.customer_preferred_cust_flag ASC NULLS FIRST], true
         +- 'Project ['t_s_secyear.customer_id, 't_s_secyear.customer_first_name, 't_s_secyear.customer_last_name, 't_s_secyear.customer_preferred_cust_flag]
            +- 'Filter (((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) && ('t_s_firstyear.customer_id = 't_c_secyear.customer_id)) && ('t_s_firstyear.customer_id = 't_c_firstyear.customer_id)) && ((('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) && ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) && ('t_s_firstyear.sale_type = s))) && (((('t_c_firstyear.sale_type = c) && ('t_w_firstyear.sale_type = w)) && ('t_s_secyear.sale_type = s)) && (('t_c_secyear.sale_type = c) && ('t_w_secyear.sale_type = w)))) && ((((('t_s_firstyear.dyear = 2001) && ('t_s_secyear.dyear = (2001 + 1))) && ('t_c_firstyear.dyear = 2001)) && ((('t_c_secyear.dyear = (2001 + 1)) && ('t_w_firstyear.dyear = 2001)) && ('t_w_secyear.dyear = (2001 + 1)))) && (((('t_s_firstyear.year_total > 0) && ('t_c_firstyear.year_total > 0)) && ('t_w_firstyear.year_total > 0)) && ((CASE WHEN ('t_c_firstyear.year_total > 0) THEN ('t_c_secyear.year_total / 't_c_firstyear.year_total) ELSE null END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE null END) && (CASE WHEN ('t_c_firstyear.year_total > 0) THEN ('t_c_secyear.year_total / 't_c_firstyear.year_total) ELSE null END > CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE null END)))))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'Join Inner
                  :  :  :- 'Join Inner
                  :  :  :  :- 'Join Inner
                  :  :  :  :  :- 'SubqueryAlias `t_s_firstyear`
                  :  :  :  :  :  +- 'UnresolvedRelation `year_total`
                  :  :  :  :  +- 'SubqueryAlias `t_s_secyear`
                  :  :  :  :     +- 'UnresolvedRelation `year_total`
                  :  :  :  +- 'SubqueryAlias `t_c_firstyear`
                  :  :  :     +- 'UnresolvedRelation `year_total`
                  :  :  +- 'SubqueryAlias `t_c_secyear`
                  :  :     +- 'UnresolvedRelation `year_total`
                  :  +- 'SubqueryAlias `t_w_firstyear`
                  :     +- 'UnresolvedRelation `year_total`
                  +- 'SubqueryAlias `t_w_secyear`
                     +- 'UnresolvedRelation `year_total`

== Analyzed Logical Plan ==
customer_id: string, customer_first_name: string, customer_last_name: string, customer_preferred_cust_flag: string
GlobalLimit 100
+- LocalLimit 100
   +- Sort [customer_id#172 ASC NULLS FIRST, customer_first_name#173 ASC NULLS FIRST, customer_last_name#174 ASC NULLS FIRST, customer_preferred_cust_flag#175 ASC NULLS FIRST], true
      +- Project [customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175]
         +- Filter ((((((customer_id#172 = customer_id#0) && (customer_id#0 = customer_id#192)) && (customer_id#0 = customer_id#182)) && (((customer_id#0 = customer_id#202) && (customer_id#0 = customer_id#212)) && (sale_type#9 = s))) && ((((sale_type#191 = c) && (sale_type#211 = w)) && (sale_type#181 = s)) && ((sale_type#201 = c) && (sale_type#221 = w)))) && (((((dyear#7 = 2001) && (dyear#179 = (2001 + 1))) && (dyear#189 = 2001)) && (((dyear#199 = (2001 + 1)) && (dyear#209 = 2001)) && (dyear#219 = (2001 + 1)))) && ((((year_total#8 > cast(0 as double)) && (year_total#190 > cast(0 as double))) && (year_total#210 > cast(0 as double))) && ((CASE WHEN (year_total#190 > cast(0 as double)) THEN (year_total#200 / year_total#190) ELSE cast(null as double) END > CASE WHEN (year_total#8 > cast(0 as double)) THEN (year_total#180 / year_total#8) ELSE cast(null as double) END) && (CASE WHEN (year_total#190 > cast(0 as double)) THEN (year_total#200 / year_total#190) ELSE cast(null as double) END > CASE WHEN (year_total#210 > cast(0 as double)) THEN (year_total#220 / year_total#210) ELSE cast(null as double) END)))))
            +- Join Inner
               :- Join Inner
               :  :- Join Inner
               :  :  :- Join Inner
               :  :  :  :- Join Inner
               :  :  :  :  :- SubqueryAlias `t_s_firstyear`
               :  :  :  :  :  +- SubqueryAlias `year_total`
               :  :  :  :  :     +- Union
               :  :  :  :  :        :- Union
               :  :  :  :  :        :  :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#0, c_first_name#40 AS customer_first_name#1, c_last_name#41 AS customer_last_name#2, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#3, c_birth_country#46 AS customer_birth_country#4, c_login#47 AS customer_login#5, c_email_address#48 AS customer_email_address#6, d_year#79 AS dyear#7, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / cast(2 as double))) AS year_total#8, s AS sale_type#9]
               :  :  :  :  :        :  :  +- Filter ((c_customer_sk#32 = ss_customer_sk#53) && (ss_sold_date_sk#50 = d_date_sk#73))
               :  :  :  :  :        :  :     +- Join Inner
               :  :  :  :  :        :  :        :- Join Inner
               :  :  :  :  :        :  :        :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :  :  :        :  :        :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :  :  :        :  :        :  +- SubqueryAlias `tpcds`.`store_sales`
               :  :  :  :  :        :  :        :     +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
               :  :  :  :  :        :  :        +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :  :  :        :  :           +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :  :  :        :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, c_first_name#40 AS customer_first_name#11, c_last_name#41 AS customer_last_name#12, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#13, c_birth_country#46 AS customer_birth_country#14, c_login#47 AS customer_login#15, c_email_address#48 AS customer_email_address#16, d_year#79 AS dyear#17, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / cast(2 as double))) AS year_total#18, c AS sale_type#19]
               :  :  :  :  :        :     +- Filter ((c_customer_sk#32 = cs_bill_customer_sk#104) && (cs_sold_date_sk#101 = d_date_sk#73))
               :  :  :  :  :        :        +- Join Inner
               :  :  :  :  :        :           :- Join Inner
               :  :  :  :  :        :           :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :  :  :        :           :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :  :  :        :           :  +- SubqueryAlias `tpcds`.`catalog_sales`
               :  :  :  :  :        :           :     +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
               :  :  :  :  :        :           +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :  :  :        :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :  :  :        +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, c_first_name#40 AS customer_first_name#21, c_last_name#41 AS customer_last_name#22, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#23, c_birth_country#46 AS customer_birth_country#24, c_login#47 AS customer_login#25, c_email_address#48 AS customer_email_address#26, d_year#79 AS dyear#27, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / cast(2 as double))) AS year_total#28, w AS sale_type#29]
               :  :  :  :  :           +- Filter ((c_customer_sk#32 = ws_bill_customer_sk#139) && (ws_sold_date_sk#135 = d_date_sk#73))
               :  :  :  :  :              +- Join Inner
               :  :  :  :  :                 :- Join Inner
               :  :  :  :  :                 :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :  :  :                 :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :  :  :                 :  +- SubqueryAlias `tpcds`.`web_sales`
               :  :  :  :  :                 :     +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
               :  :  :  :  :                 +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :  :  :                    +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :  :  +- SubqueryAlias `t_s_secyear`
               :  :  :  :     +- SubqueryAlias `year_total`
               :  :  :  :        +- Union
               :  :  :  :           :- Union
               :  :  :  :           :  :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#172, c_first_name#40 AS customer_first_name#173, c_last_name#41 AS customer_last_name#174, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#175, c_birth_country#46 AS customer_birth_country#176, c_login#47 AS customer_login#177, c_email_address#48 AS customer_email_address#178, d_year#79 AS dyear#179, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / cast(2 as double))) AS year_total#180, s AS sale_type#181]
               :  :  :  :           :  :  +- Filter ((c_customer_sk#32 = ss_customer_sk#53) && (ss_sold_date_sk#50 = d_date_sk#73))
               :  :  :  :           :  :     +- Join Inner
               :  :  :  :           :  :        :- Join Inner
               :  :  :  :           :  :        :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :  :           :  :        :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :  :           :  :        :  +- SubqueryAlias `tpcds`.`store_sales`
               :  :  :  :           :  :        :     +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
               :  :  :  :           :  :        +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :  :           :  :           +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :  :           :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, c_first_name#40 AS customer_first_name#11, c_last_name#41 AS customer_last_name#12, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#13, c_birth_country#46 AS customer_birth_country#14, c_login#47 AS customer_login#15, c_email_address#48 AS customer_email_address#16, d_year#79 AS dyear#17, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / cast(2 as double))) AS year_total#18, c AS sale_type#19]
               :  :  :  :           :     +- Filter ((c_customer_sk#32 = cs_bill_customer_sk#104) && (cs_sold_date_sk#101 = d_date_sk#73))
               :  :  :  :           :        +- Join Inner
               :  :  :  :           :           :- Join Inner
               :  :  :  :           :           :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :  :           :           :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :  :           :           :  +- SubqueryAlias `tpcds`.`catalog_sales`
               :  :  :  :           :           :     +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
               :  :  :  :           :           +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :  :           :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :  :           +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, c_first_name#40 AS customer_first_name#21, c_last_name#41 AS customer_last_name#22, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#23, c_birth_country#46 AS customer_birth_country#24, c_login#47 AS customer_login#25, c_email_address#48 AS customer_email_address#26, d_year#79 AS dyear#27, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / cast(2 as double))) AS year_total#28, w AS sale_type#29]
               :  :  :  :              +- Filter ((c_customer_sk#32 = ws_bill_customer_sk#139) && (ws_sold_date_sk#135 = d_date_sk#73))
               :  :  :  :                 +- Join Inner
               :  :  :  :                    :- Join Inner
               :  :  :  :                    :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :  :                    :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :  :                    :  +- SubqueryAlias `tpcds`.`web_sales`
               :  :  :  :                    :     +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
               :  :  :  :                    +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :  :                       +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :  +- SubqueryAlias `t_c_firstyear`
               :  :  :     +- SubqueryAlias `year_total`
               :  :  :        +- Union
               :  :  :           :- Union
               :  :  :           :  :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#182, c_first_name#40 AS customer_first_name#183, c_last_name#41 AS customer_last_name#184, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#185, c_birth_country#46 AS customer_birth_country#186, c_login#47 AS customer_login#187, c_email_address#48 AS customer_email_address#188, d_year#79 AS dyear#189, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / cast(2 as double))) AS year_total#190, s AS sale_type#191]
               :  :  :           :  :  +- Filter ((c_customer_sk#32 = ss_customer_sk#53) && (ss_sold_date_sk#50 = d_date_sk#73))
               :  :  :           :  :     +- Join Inner
               :  :  :           :  :        :- Join Inner
               :  :  :           :  :        :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :           :  :        :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :           :  :        :  +- SubqueryAlias `tpcds`.`store_sales`
               :  :  :           :  :        :     +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
               :  :  :           :  :        +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :           :  :           +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :           :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, c_first_name#40 AS customer_first_name#11, c_last_name#41 AS customer_last_name#12, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#13, c_birth_country#46 AS customer_birth_country#14, c_login#47 AS customer_login#15, c_email_address#48 AS customer_email_address#16, d_year#79 AS dyear#17, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / cast(2 as double))) AS year_total#18, c AS sale_type#19]
               :  :  :           :     +- Filter ((c_customer_sk#32 = cs_bill_customer_sk#104) && (cs_sold_date_sk#101 = d_date_sk#73))
               :  :  :           :        +- Join Inner
               :  :  :           :           :- Join Inner
               :  :  :           :           :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :           :           :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :           :           :  +- SubqueryAlias `tpcds`.`catalog_sales`
               :  :  :           :           :     +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
               :  :  :           :           +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :           :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  :           +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, c_first_name#40 AS customer_first_name#21, c_last_name#41 AS customer_last_name#22, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#23, c_birth_country#46 AS customer_birth_country#24, c_login#47 AS customer_login#25, c_email_address#48 AS customer_email_address#26, d_year#79 AS dyear#27, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / cast(2 as double))) AS year_total#28, w AS sale_type#29]
               :  :  :              +- Filter ((c_customer_sk#32 = ws_bill_customer_sk#139) && (ws_sold_date_sk#135 = d_date_sk#73))
               :  :  :                 +- Join Inner
               :  :  :                    :- Join Inner
               :  :  :                    :  :- SubqueryAlias `tpcds`.`customer`
               :  :  :                    :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :  :                    :  +- SubqueryAlias `tpcds`.`web_sales`
               :  :  :                    :     +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
               :  :  :                    +- SubqueryAlias `tpcds`.`date_dim`
               :  :  :                       +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :  +- SubqueryAlias `t_c_secyear`
               :  :     +- SubqueryAlias `year_total`
               :  :        +- Union
               :  :           :- Union
               :  :           :  :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#192, c_first_name#40 AS customer_first_name#193, c_last_name#41 AS customer_last_name#194, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#195, c_birth_country#46 AS customer_birth_country#196, c_login#47 AS customer_login#197, c_email_address#48 AS customer_email_address#198, d_year#79 AS dyear#199, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / cast(2 as double))) AS year_total#200, s AS sale_type#201]
               :  :           :  :  +- Filter ((c_customer_sk#32 = ss_customer_sk#53) && (ss_sold_date_sk#50 = d_date_sk#73))
               :  :           :  :     +- Join Inner
               :  :           :  :        :- Join Inner
               :  :           :  :        :  :- SubqueryAlias `tpcds`.`customer`
               :  :           :  :        :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :           :  :        :  +- SubqueryAlias `tpcds`.`store_sales`
               :  :           :  :        :     +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
               :  :           :  :        +- SubqueryAlias `tpcds`.`date_dim`
               :  :           :  :           +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :           :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, c_first_name#40 AS customer_first_name#11, c_last_name#41 AS customer_last_name#12, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#13, c_birth_country#46 AS customer_birth_country#14, c_login#47 AS customer_login#15, c_email_address#48 AS customer_email_address#16, d_year#79 AS dyear#17, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / cast(2 as double))) AS year_total#18, c AS sale_type#19]
               :  :           :     +- Filter ((c_customer_sk#32 = cs_bill_customer_sk#104) && (cs_sold_date_sk#101 = d_date_sk#73))
               :  :           :        +- Join Inner
               :  :           :           :- Join Inner
               :  :           :           :  :- SubqueryAlias `tpcds`.`customer`
               :  :           :           :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :           :           :  +- SubqueryAlias `tpcds`.`catalog_sales`
               :  :           :           :     +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
               :  :           :           +- SubqueryAlias `tpcds`.`date_dim`
               :  :           :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  :           +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, c_first_name#40 AS customer_first_name#21, c_last_name#41 AS customer_last_name#22, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#23, c_birth_country#46 AS customer_birth_country#24, c_login#47 AS customer_login#25, c_email_address#48 AS customer_email_address#26, d_year#79 AS dyear#27, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / cast(2 as double))) AS year_total#28, w AS sale_type#29]
               :  :              +- Filter ((c_customer_sk#32 = ws_bill_customer_sk#139) && (ws_sold_date_sk#135 = d_date_sk#73))
               :  :                 +- Join Inner
               :  :                    :- Join Inner
               :  :                    :  :- SubqueryAlias `tpcds`.`customer`
               :  :                    :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :  :                    :  +- SubqueryAlias `tpcds`.`web_sales`
               :  :                    :     +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
               :  :                    +- SubqueryAlias `tpcds`.`date_dim`
               :  :                       +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :  +- SubqueryAlias `t_w_firstyear`
               :     +- SubqueryAlias `year_total`
               :        +- Union
               :           :- Union
               :           :  :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#202, c_first_name#40 AS customer_first_name#203, c_last_name#41 AS customer_last_name#204, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#205, c_birth_country#46 AS customer_birth_country#206, c_login#47 AS customer_login#207, c_email_address#48 AS customer_email_address#208, d_year#79 AS dyear#209, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / cast(2 as double))) AS year_total#210, s AS sale_type#211]
               :           :  :  +- Filter ((c_customer_sk#32 = ss_customer_sk#53) && (ss_sold_date_sk#50 = d_date_sk#73))
               :           :  :     +- Join Inner
               :           :  :        :- Join Inner
               :           :  :        :  :- SubqueryAlias `tpcds`.`customer`
               :           :  :        :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :           :  :        :  +- SubqueryAlias `tpcds`.`store_sales`
               :           :  :        :     +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
               :           :  :        +- SubqueryAlias `tpcds`.`date_dim`
               :           :  :           +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :           :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, c_first_name#40 AS customer_first_name#11, c_last_name#41 AS customer_last_name#12, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#13, c_birth_country#46 AS customer_birth_country#14, c_login#47 AS customer_login#15, c_email_address#48 AS customer_email_address#16, d_year#79 AS dyear#17, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / cast(2 as double))) AS year_total#18, c AS sale_type#19]
               :           :     +- Filter ((c_customer_sk#32 = cs_bill_customer_sk#104) && (cs_sold_date_sk#101 = d_date_sk#73))
               :           :        +- Join Inner
               :           :           :- Join Inner
               :           :           :  :- SubqueryAlias `tpcds`.`customer`
               :           :           :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :           :           :  +- SubqueryAlias `tpcds`.`catalog_sales`
               :           :           :     +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
               :           :           +- SubqueryAlias `tpcds`.`date_dim`
               :           :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               :           +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, c_first_name#40 AS customer_first_name#21, c_last_name#41 AS customer_last_name#22, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#23, c_birth_country#46 AS customer_birth_country#24, c_login#47 AS customer_login#25, c_email_address#48 AS customer_email_address#26, d_year#79 AS dyear#27, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / cast(2 as double))) AS year_total#28, w AS sale_type#29]
               :              +- Filter ((c_customer_sk#32 = ws_bill_customer_sk#139) && (ws_sold_date_sk#135 = d_date_sk#73))
               :                 +- Join Inner
               :                    :- Join Inner
               :                    :  :- SubqueryAlias `tpcds`.`customer`
               :                    :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
               :                    :  +- SubqueryAlias `tpcds`.`web_sales`
               :                    :     +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
               :                    +- SubqueryAlias `tpcds`.`date_dim`
               :                       +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
               +- SubqueryAlias `t_w_secyear`
                  +- SubqueryAlias `year_total`
                     +- Union
                        :- Union
                        :  :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#212, c_first_name#40 AS customer_first_name#213, c_last_name#41 AS customer_last_name#214, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#215, c_birth_country#46 AS customer_birth_country#216, c_login#47 AS customer_login#217, c_email_address#48 AS customer_email_address#218, d_year#79 AS dyear#219, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / cast(2 as double))) AS year_total#220, s AS sale_type#221]
                        :  :  +- Filter ((c_customer_sk#32 = ss_customer_sk#53) && (ss_sold_date_sk#50 = d_date_sk#73))
                        :  :     +- Join Inner
                        :  :        :- Join Inner
                        :  :        :  :- SubqueryAlias `tpcds`.`customer`
                        :  :        :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
                        :  :        :  +- SubqueryAlias `tpcds`.`store_sales`
                        :  :        :     +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
                        :  :        +- SubqueryAlias `tpcds`.`date_dim`
                        :  :           +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
                        :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, c_first_name#40 AS customer_first_name#11, c_last_name#41 AS customer_last_name#12, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#13, c_birth_country#46 AS customer_birth_country#14, c_login#47 AS customer_login#15, c_email_address#48 AS customer_email_address#16, d_year#79 AS dyear#17, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / cast(2 as double))) AS year_total#18, c AS sale_type#19]
                        :     +- Filter ((c_customer_sk#32 = cs_bill_customer_sk#104) && (cs_sold_date_sk#101 = d_date_sk#73))
                        :        +- Join Inner
                        :           :- Join Inner
                        :           :  :- SubqueryAlias `tpcds`.`customer`
                        :           :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
                        :           :  +- SubqueryAlias `tpcds`.`catalog_sales`
                        :           :     +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
                        :           +- SubqueryAlias `tpcds`.`date_dim`
                        :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
                        +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, c_first_name#40 AS customer_first_name#21, c_last_name#41 AS customer_last_name#22, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#23, c_birth_country#46 AS customer_birth_country#24, c_login#47 AS customer_login#25, c_email_address#48 AS customer_email_address#26, d_year#79 AS dyear#27, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / cast(2 as double))) AS year_total#28, w AS sale_type#29]
                           +- Filter ((c_customer_sk#32 = ws_bill_customer_sk#139) && (ws_sold_date_sk#135 = d_date_sk#73))
                              +- Join Inner
                                 :- Join Inner
                                 :  :- SubqueryAlias `tpcds`.`customer`
                                 :  :  +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
                                 :  +- SubqueryAlias `tpcds`.`web_sales`
                                 :     +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
                                 +- SubqueryAlias `tpcds`.`date_dim`
                                    +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [customer_id#172 ASC NULLS FIRST, customer_first_name#173 ASC NULLS FIRST, customer_last_name#174 ASC NULLS FIRST, customer_preferred_cust_flag#175 ASC NULLS FIRST], true
      +- Project [customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175]
         +- Join Inner, ((customer_id#0 = customer_id#212) && (CASE WHEN (year_total#190 > 0.0) THEN (year_total#200 / year_total#190) ELSE null END > CASE WHEN (year_total#210 > 0.0) THEN (year_total#220 / year_total#210) ELSE null END))
            :- Project [customer_id#0, customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#190, year_total#200, year_total#210]
            :  +- Join Inner, (customer_id#0 = customer_id#202)
            :     :- Project [customer_id#0, customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#190, year_total#200]
            :     :  +- Join Inner, ((customer_id#0 = customer_id#192) && (CASE WHEN (year_total#190 > 0.0) THEN (year_total#200 / year_total#190) ELSE null END > CASE WHEN (year_total#8 > 0.0) THEN (year_total#180 / year_total#8) ELSE null END))
            :     :     :- Project [customer_id#0, year_total#8, customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#180, year_total#190]
            :     :     :  +- Join Inner, (customer_id#0 = customer_id#182)
            :     :     :     :- Join Inner, (customer_id#172 = customer_id#0)
            :     :     :     :  :- Union
            :     :     :     :  :  :- Filter (isnotnull(year_total#8) && (year_total#8 > 0.0))
            :     :     :     :  :  :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#0, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / 2.0)) AS year_total#8]
            :     :     :     :  :  :     +- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67, d_year#79]
            :     :     :     :  :  :        +- Join Inner, (ss_sold_date_sk#50 = d_date_sk#73)
            :     :     :     :  :  :           :- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_sold_date_sk#50, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
            :     :     :     :  :  :           :  +- Join Inner, (c_customer_sk#32 = ss_customer_sk#53)
            :     :     :     :  :  :           :     :- Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
            :     :     :     :  :  :           :     :  +- Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
            :     :     :     :  :  :           :     :     +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
            :     :     :     :  :  :           :     +- Project [ss_sold_date_sk#50, ss_customer_sk#53, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
            :     :     :     :  :  :           :        +- Filter (isnotnull(ss_customer_sk#53) && isnotnull(ss_sold_date_sk#50))
            :     :     :     :  :  :           :           +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
            :     :     :     :  :  :           +- Project [d_date_sk#73, d_year#79]
            :     :     :     :  :  :              +- Filter ((isnotnull(d_year#79) && (d_year#79 = 2001)) && isnotnull(d_date_sk#73))
            :     :     :     :  :  :                 +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
            :     :     :     :  :  :- LocalRelation <empty>, [customer_id#10, year_total#18]
            :     :     :     :  :  +- LocalRelation <empty>, [customer_id#20, year_total#28]
            :     :     :     :  +- Union
            :     :     :     :     :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#172, c_first_name#40 AS customer_first_name#173, c_last_name#41 AS customer_last_name#174, c_preferred_cust_flag#42 AS customer_preferred_cust_flag#175, sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / 2.0)) AS year_total#180]
            :     :     :     :     :  +- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67, d_year#79]
            :     :     :     :     :     +- Join Inner, (ss_sold_date_sk#50 = d_date_sk#73)
            :     :     :     :     :        :- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_sold_date_sk#50, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
            :     :     :     :     :        :  +- Join Inner, (c_customer_sk#32 = ss_customer_sk#53)
            :     :     :     :     :        :     :- Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
            :     :     :     :     :        :     :  +- Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
            :     :     :     :     :        :     :     +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
            :     :     :     :     :        :     +- Project [ss_sold_date_sk#50, ss_customer_sk#53, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
            :     :     :     :     :        :        +- Filter (isnotnull(ss_customer_sk#53) && isnotnull(ss_sold_date_sk#50))
            :     :     :     :     :        :           +- Relation[ss_sold_date_sk#50,ss_sold_time_sk#51,ss_item_sk#52,ss_customer_sk#53,ss_cdemo_sk#54,ss_hdemo_sk#55,ss_addr_sk#56,ss_store_sk#57,ss_promo_sk#58,ss_ticket_number#59,ss_quantity#60,ss_wholesale_cost#61,ss_list_price#62,ss_sales_price#63,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67,ss_ext_tax#68,ss_coupon_amt#69,ss_net_paid#70,ss_net_paid_inc_tax#71,ss_net_profit#72] parquet
            :     :     :     :     :        +- Project [d_date_sk#73, d_year#79]
            :     :     :     :     :           +- Filter ((isnotnull(d_year#79) && (d_year#79 = 2002)) && isnotnull(d_date_sk#73))
            :     :     :     :     :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
            :     :     :     :     :- LocalRelation <empty>, [customer_id#10, customer_first_name#11, customer_last_name#12, customer_preferred_cust_flag#13, year_total#18]
            :     :     :     :     +- LocalRelation <empty>, [customer_id#20, customer_first_name#21, customer_last_name#22, customer_preferred_cust_flag#23, year_total#28]
            :     :     :     +- Union
            :     :     :        :- LocalRelation <empty>, [customer_id#182, year_total#190]
            :     :     :        :- Filter (isnotnull(year_total#18) && (year_total#18 > 0.0))
            :     :     :        :  +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / 2.0)) AS year_total#18]
            :     :     :        :     +- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126, d_year#79]
            :     :     :        :        +- Join Inner, (cs_sold_date_sk#101 = d_date_sk#73)
            :     :     :        :           :- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_sold_date_sk#101, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
            :     :     :        :           :  +- Join Inner, (c_customer_sk#32 = cs_bill_customer_sk#104)
            :     :     :        :           :     :- Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
            :     :     :        :           :     :  +- Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
            :     :     :        :           :     :     +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
            :     :     :        :           :     +- Project [cs_sold_date_sk#101, cs_bill_customer_sk#104, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
            :     :     :        :           :        +- Filter (isnotnull(cs_bill_customer_sk#104) && isnotnull(cs_sold_date_sk#101))
            :     :     :        :           :           +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
            :     :     :        :           +- Project [d_date_sk#73, d_year#79]
            :     :     :        :              +- Filter ((isnotnull(d_year#79) && (d_year#79 = 2001)) && isnotnull(d_date_sk#73))
            :     :     :        :                 +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
            :     :     :        +- LocalRelation <empty>, [customer_id#20, year_total#28]
            :     :     +- Union
            :     :        :- LocalRelation <empty>, [customer_id#192, year_total#200]
            :     :        :- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#10, sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / 2.0)) AS year_total#18]
            :     :        :  +- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126, d_year#79]
            :     :        :     +- Join Inner, (cs_sold_date_sk#101 = d_date_sk#73)
            :     :        :        :- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_sold_date_sk#101, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
            :     :        :        :  +- Join Inner, (c_customer_sk#32 = cs_bill_customer_sk#104)
            :     :        :        :     :- Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
            :     :        :        :     :  +- Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
            :     :        :        :     :     +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
            :     :        :        :     +- Project [cs_sold_date_sk#101, cs_bill_customer_sk#104, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
            :     :        :        :        +- Filter (isnotnull(cs_bill_customer_sk#104) && isnotnull(cs_sold_date_sk#101))
            :     :        :        :           +- Relation[cs_sold_date_sk#101,cs_sold_time_sk#102,cs_ship_date_sk#103,cs_bill_customer_sk#104,cs_bill_cdemo_sk#105,cs_bill_hdemo_sk#106,cs_bill_addr_sk#107,cs_ship_customer_sk#108,cs_ship_cdemo_sk#109,cs_ship_hdemo_sk#110,cs_ship_addr_sk#111,cs_call_center_sk#112,cs_catalog_page_sk#113,cs_ship_mode_sk#114,cs_warehouse_sk#115,cs_item_sk#116,cs_promo_sk#117,cs_order_number#118,cs_quantity#119,cs_wholesale_cost#120,cs_list_price#121,cs_sales_price#122,cs_ext_discount_amt#123,cs_ext_sales_price#124,... 10 more fields] parquet
            :     :        :        +- Project [d_date_sk#73, d_year#79]
            :     :        :           +- Filter ((isnotnull(d_year#79) && (d_year#79 = 2002)) && isnotnull(d_date_sk#73))
            :     :        :              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
            :     :        +- LocalRelation <empty>, [customer_id#20, year_total#28]
            :     +- Union
            :        :- LocalRelation <empty>, [customer_id#202, year_total#210]
            :        :- LocalRelation <empty>, [customer_id#10, year_total#18]
            :        +- Filter (isnotnull(year_total#28) && (year_total#28 > 0.0))
            :           +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / 2.0)) AS year_total#28]
            :              +- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160, d_year#79]
            :                 +- Join Inner, (ws_sold_date_sk#135 = d_date_sk#73)
            :                    :- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_sold_date_sk#135, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
            :                    :  +- Join Inner, (c_customer_sk#32 = ws_bill_customer_sk#139)
            :                    :     :- Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
            :                    :     :  +- Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
            :                    :     :     +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
            :                    :     +- Project [ws_sold_date_sk#135, ws_bill_customer_sk#139, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
            :                    :        +- Filter (isnotnull(ws_bill_customer_sk#139) && isnotnull(ws_sold_date_sk#135))
            :                    :           +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
            :                    +- Project [d_date_sk#73, d_year#79]
            :                       +- Filter ((isnotnull(d_year#79) && (d_year#79 = 2001)) && isnotnull(d_date_sk#73))
            :                          +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet
            +- Union
               :- LocalRelation <empty>, [customer_id#212, year_total#220]
               :- LocalRelation <empty>, [customer_id#10, year_total#18]
               +- Aggregate [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], [c_customer_id#33 AS customer_id#20, sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / 2.0)) AS year_total#28]
                  +- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160, d_year#79]
                     +- Join Inner, (ws_sold_date_sk#135 = d_date_sk#73)
                        :- Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_sold_date_sk#135, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
                        :  +- Join Inner, (c_customer_sk#32 = ws_bill_customer_sk#139)
                        :     :- Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
                        :     :  +- Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
                        :     :     +- Relation[c_customer_sk#32,c_customer_id#33,c_current_cdemo_sk#34,c_current_hdemo_sk#35,c_current_addr_sk#36,c_first_shipto_date_sk#37,c_first_sales_date_sk#38,c_salutation#39,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_day#43,c_birth_month#44,c_birth_year#45,c_birth_country#46,c_login#47,c_email_address#48,c_last_review_date#49] parquet
                        :     +- Project [ws_sold_date_sk#135, ws_bill_customer_sk#139, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
                        :        +- Filter (isnotnull(ws_bill_customer_sk#139) && isnotnull(ws_sold_date_sk#135))
                        :           +- Relation[ws_sold_date_sk#135,ws_sold_time_sk#136,ws_ship_date_sk#137,ws_item_sk#138,ws_bill_customer_sk#139,ws_bill_cdemo_sk#140,ws_bill_hdemo_sk#141,ws_bill_addr_sk#142,ws_ship_customer_sk#143,ws_ship_cdemo_sk#144,ws_ship_hdemo_sk#145,ws_ship_addr_sk#146,ws_web_page_sk#147,ws_web_site_sk#148,ws_ship_mode_sk#149,ws_warehouse_sk#150,ws_promo_sk#151,ws_order_number#152,ws_quantity#153,ws_wholesale_cost#154,ws_list_price#155,ws_sales_price#156,ws_ext_discount_amt#157,ws_ext_sales_price#158,... 10 more fields] parquet
                        +- Project [d_date_sk#73, d_year#79]
                           +- Filter ((isnotnull(d_year#79) && (d_year#79 = 2002)) && isnotnull(d_date_sk#73))
                              +- Relation[d_date_sk#73,d_date_id#74,d_date#75,d_month_seq#76,d_week_seq#77,d_quarter_seq#78,d_year#79,d_dow#80,d_moy#81,d_dom#82,d_qoy#83,d_fy_year#84,d_fy_quarter_seq#85,d_fy_week_seq#86,d_day_name#87,d_quarter_name#88,d_holiday#89,d_weekend#90,d_following_holiday#91,d_first_dom#92,d_last_dom#93,d_same_day_ly#94,d_same_day_lq#95,d_current_day#96,... 4 more fields] parquet

== Physical Plan ==
TakeOrderedAndProject(limit=100, orderBy=[customer_id#172 ASC NULLS FIRST,customer_first_name#173 ASC NULLS FIRST,customer_last_name#174 ASC NULLS FIRST,customer_preferred_cust_flag#175 ASC NULLS FIRST], output=[customer_id#172,customer_first_name#173,customer_last_name#174,customer_preferred_cust_flag#175])
+- *(35) Project [customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175]
   +- *(35) SortMergeJoin [customer_id#0], [customer_id#212], Inner, (CASE WHEN (year_total#190 > 0.0) THEN (year_total#200 / year_total#190) ELSE null END > CASE WHEN (year_total#210 > 0.0) THEN (year_total#220 / year_total#210) ELSE null END)
      :- *(29) Project [customer_id#0, customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#190, year_total#200, year_total#210]
      :  +- *(29) SortMergeJoin [customer_id#0], [customer_id#202], Inner
      :     :- *(23) Project [customer_id#0, customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#190, year_total#200]
      :     :  +- *(23) SortMergeJoin [customer_id#0], [customer_id#192], Inner, (CASE WHEN (year_total#190 > 0.0) THEN (year_total#200 / year_total#190) ELSE null END > CASE WHEN (year_total#8 > 0.0) THEN (year_total#180 / year_total#8) ELSE null END)
      :     :     :- *(17) Project [customer_id#0, year_total#8, customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#180, year_total#190]
      :     :     :  +- *(17) SortMergeJoin [customer_id#0], [customer_id#182], Inner
      :     :     :     :- *(11) SortMergeJoin [customer_id#0], [customer_id#172], Inner
      :     :     :     :  :- *(5) Sort [customer_id#0 ASC NULLS FIRST], false, 0
      :     :     :     :  :  +- Exchange hashpartitioning(customer_id#0, 200)
      :     :     :     :  :     +- Union
      :     :     :     :  :        :- *(4) Filter (isnotnull(year_total#8) && (year_total#8 > 0.0))
      :     :     :     :  :        :  +- *(4) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / 2.0))], output=[customer_id#0, year_total#8])
      :     :     :     :  :        :     +- Exchange hashpartitioning(c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, 200)
      :     :     :     :  :        :        +- *(3) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[partial_sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / 2.0))], output=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, sum#223])
      :     :     :     :  :        :           +- *(3) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67, d_year#79]
      :     :     :     :  :        :              +- *(3) BroadcastHashJoin [ss_sold_date_sk#50], [d_date_sk#73], Inner, BuildRight
      :     :     :     :  :        :                 :- *(3) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_sold_date_sk#50, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
      :     :     :     :  :        :                 :  +- *(3) BroadcastHashJoin [c_customer_sk#32], [ss_customer_sk#53], Inner, BuildLeft
      :     :     :     :  :        :                 :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :     :  :        :                 :     :  +- *(1) Project [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48]
      :     :     :     :  :        :                 :     :     +- *(1) Filter (isnotnull(c_customer_sk#32) && isnotnull(c_customer_id#33))
      :     :     :     :  :        :                 :     :        +- *(1) FileScan parquet tpcds.customer[c_customer_sk#32,c_customer_id#33,c_first_name#40,c_last_name#41,c_preferred_cust_flag#42,c_birth_country#46,c_login#47,c_email_address#48] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/c..., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...
      :     :     :     :  :        :                 :     +- *(3) Project [ss_sold_date_sk#50, ss_customer_sk#53, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
      :     :     :     :  :        :                 :        +- *(3) Filter (isnotnull(ss_customer_sk#53) && isnotnull(ss_sold_date_sk#50))
      :     :     :     :  :        :                 :           +- *(3) FileScan parquet tpcds.store_sales[ss_sold_date_sk#50,ss_customer_sk#53,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/s..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_ext_discount_amt:double,ss_ext_sales_price:doubl...
      :     :     :     :  :        :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :     :  :        :                    +- *(2) Project [d_date_sk#73, d_year#79]
      :     :     :     :  :        :                       +- *(2) Filter ((isnotnull(d_year#79) && (d_year#79 = 2001)) && isnotnull(d_date_sk#73))
      :     :     :     :  :        :                          +- *(2) FileScan parquet tpcds.date_dim[d_date_sk#73,d_year#79] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/d..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
      :     :     :     :  :        :- LocalTableScan <empty>, [customer_id#10, year_total#18]
      :     :     :     :  :        +- LocalTableScan <empty>, [customer_id#20, year_total#28]
      :     :     :     :  +- *(10) Sort [customer_id#172 ASC NULLS FIRST], false, 0
      :     :     :     :     +- Exchange hashpartitioning(customer_id#172, 200)
      :     :     :     :        +- Union
      :     :     :     :           :- *(9) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / 2.0))], output=[customer_id#172, customer_first_name#173, customer_last_name#174, customer_preferred_cust_flag#175, year_total#180])
      :     :     :     :           :  +- Exchange hashpartitioning(c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, 200)
      :     :     :     :           :     +- *(8) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[partial_sum(((((ss_ext_list_price#67 - ss_ext_wholesale_cost#66) - ss_ext_discount_amt#64) + ss_ext_sales_price#65) / 2.0))], output=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, sum#225])
      :     :     :     :           :        +- *(8) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67, d_year#79]
      :     :     :     :           :           +- *(8) BroadcastHashJoin [ss_sold_date_sk#50], [d_date_sk#73], Inner, BuildRight
      :     :     :     :           :              :- *(8) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ss_sold_date_sk#50, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
      :     :     :     :           :              :  +- *(8) BroadcastHashJoin [c_customer_sk#32], [ss_customer_sk#53], Inner, BuildLeft
      :     :     :     :           :              :     :- ReusedExchange [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :     :           :              :     +- *(8) Project [ss_sold_date_sk#50, ss_customer_sk#53, ss_ext_discount_amt#64, ss_ext_sales_price#65, ss_ext_wholesale_cost#66, ss_ext_list_price#67]
      :     :     :     :           :              :        +- *(8) Filter (isnotnull(ss_customer_sk#53) && isnotnull(ss_sold_date_sk#50))
      :     :     :     :           :              :           +- *(8) FileScan parquet tpcds.store_sales[ss_sold_date_sk#50,ss_customer_sk#53,ss_ext_discount_amt#64,ss_ext_sales_price#65,ss_ext_wholesale_cost#66,ss_ext_list_price#67] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/s..., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_ext_discount_amt:double,ss_ext_sales_price:doubl...
      :     :     :     :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :     :           :                 +- *(7) Project [d_date_sk#73, d_year#79]
      :     :     :     :           :                    +- *(7) Filter ((isnotnull(d_year#79) && (d_year#79 = 2002)) && isnotnull(d_date_sk#73))
      :     :     :     :           :                       +- *(7) FileScan parquet tpcds.date_dim[d_date_sk#73,d_year#79] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/d..., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
      :     :     :     :           :- LocalTableScan <empty>, [customer_id#10, customer_first_name#11, customer_last_name#12, customer_preferred_cust_flag#13, year_total#18]
      :     :     :     :           +- LocalTableScan <empty>, [customer_id#20, customer_first_name#21, customer_last_name#22, customer_preferred_cust_flag#23, year_total#28]
      :     :     :     +- *(16) Sort [customer_id#182 ASC NULLS FIRST], false, 0
      :     :     :        +- Exchange hashpartitioning(customer_id#182, 200)
      :     :     :           +- Union
      :     :     :              :- LocalTableScan <empty>, [customer_id#182, year_total#190]
      :     :     :              :- *(15) Filter (isnotnull(year_total#18) && (year_total#18 > 0.0))
      :     :     :              :  +- *(15) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / 2.0))], output=[customer_id#10, year_total#18])
      :     :     :              :     +- Exchange hashpartitioning(c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, 200)
      :     :     :              :        +- *(14) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[partial_sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / 2.0))], output=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, sum#227])
      :     :     :              :           +- *(14) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126, d_year#79]
      :     :     :              :              +- *(14) BroadcastHashJoin [cs_sold_date_sk#101], [d_date_sk#73], Inner, BuildRight
      :     :     :              :                 :- *(14) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_sold_date_sk#101, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
      :     :     :              :                 :  +- *(14) BroadcastHashJoin [c_customer_sk#32], [cs_bill_customer_sk#104], Inner, BuildLeft
      :     :     :              :                 :     :- ReusedExchange [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :              :                 :     +- *(14) Project [cs_sold_date_sk#101, cs_bill_customer_sk#104, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
      :     :     :              :                 :        +- *(14) Filter (isnotnull(cs_bill_customer_sk#104) && isnotnull(cs_sold_date_sk#101))
      :     :     :              :                 :           +- *(14) FileScan parquet tpcds.catalog_sales[cs_sold_date_sk#101,cs_bill_customer_sk#104,cs_ext_discount_amt#123,cs_ext_sales_price#124,cs_ext_wholesale_cost#125,cs_ext_list_price#126] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/c..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_ext_discount_amt:double,cs_ext_sales_price:...
      :     :     :              :                 +- ReusedExchange [d_date_sk#73, d_year#79], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :              +- LocalTableScan <empty>, [customer_id#20, year_total#28]
      :     :     +- *(22) Sort [customer_id#192 ASC NULLS FIRST], false, 0
      :     :        +- Exchange hashpartitioning(customer_id#192, 200)
      :     :           +- Union
      :     :              :- LocalTableScan <empty>, [customer_id#192, year_total#200]
      :     :              :- *(21) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / 2.0))], output=[customer_id#10, year_total#18])
      :     :              :  +- Exchange hashpartitioning(c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, 200)
      :     :              :     +- *(20) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[partial_sum(((((cs_ext_list_price#126 - cs_ext_wholesale_cost#125) - cs_ext_discount_amt#123) + cs_ext_sales_price#124) / 2.0))], output=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, sum#229])
      :     :              :        +- *(20) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126, d_year#79]
      :     :              :           +- *(20) BroadcastHashJoin [cs_sold_date_sk#101], [d_date_sk#73], Inner, BuildRight
      :     :              :              :- *(20) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, cs_sold_date_sk#101, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
      :     :              :              :  +- *(20) BroadcastHashJoin [c_customer_sk#32], [cs_bill_customer_sk#104], Inner, BuildLeft
      :     :              :              :     :- ReusedExchange [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :              :              :     +- *(20) Project [cs_sold_date_sk#101, cs_bill_customer_sk#104, cs_ext_discount_amt#123, cs_ext_sales_price#124, cs_ext_wholesale_cost#125, cs_ext_list_price#126]
      :     :              :              :        +- *(20) Filter (isnotnull(cs_bill_customer_sk#104) && isnotnull(cs_sold_date_sk#101))
      :     :              :              :           +- *(20) FileScan parquet tpcds.catalog_sales[cs_sold_date_sk#101,cs_bill_customer_sk#104,cs_ext_discount_amt#123,cs_ext_sales_price#124,cs_ext_wholesale_cost#125,cs_ext_list_price#126] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/c..., PartitionFilters: [], PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_ext_discount_amt:double,cs_ext_sales_price:...
      :     :              :              +- ReusedExchange [d_date_sk#73, d_year#79], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :              +- LocalTableScan <empty>, [customer_id#20, year_total#28]
      :     +- *(28) Sort [customer_id#202 ASC NULLS FIRST], false, 0
      :        +- Exchange hashpartitioning(customer_id#202, 200)
      :           +- Union
      :              :- LocalTableScan <empty>, [customer_id#202, year_total#210]
      :              :- LocalTableScan <empty>, [customer_id#10, year_total#18]
      :              +- *(27) Filter (isnotnull(year_total#28) && (year_total#28 > 0.0))
      :                 +- *(27) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / 2.0))], output=[customer_id#20, year_total#28])
      :                    +- Exchange hashpartitioning(c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, 200)
      :                       +- *(26) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[partial_sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / 2.0))], output=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, sum#231])
      :                          +- *(26) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160, d_year#79]
      :                             +- *(26) BroadcastHashJoin [ws_sold_date_sk#135], [d_date_sk#73], Inner, BuildRight
      :                                :- *(26) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_sold_date_sk#135, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
      :                                :  +- *(26) BroadcastHashJoin [c_customer_sk#32], [ws_bill_customer_sk#139], Inner, BuildLeft
      :                                :     :- ReusedExchange [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :                                :     +- *(26) Project [ws_sold_date_sk#135, ws_bill_customer_sk#139, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
      :                                :        +- *(26) Filter (isnotnull(ws_bill_customer_sk#139) && isnotnull(ws_sold_date_sk#135))
      :                                :           +- *(26) FileScan parquet tpcds.web_sales[ws_sold_date_sk#135,ws_bill_customer_sk#139,ws_ext_discount_amt#157,ws_ext_sales_price#158,ws_ext_wholesale_cost#159,ws_ext_list_price#160] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/w..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_ext_discount_amt:double,ws_ext_sales_price:...
      :                                +- ReusedExchange [d_date_sk#73, d_year#79], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      +- *(34) Sort [customer_id#212 ASC NULLS FIRST], false, 0
         +- Exchange hashpartitioning(customer_id#212, 200)
            +- Union
               :- LocalTableScan <empty>, [customer_id#212, year_total#220]
               :- LocalTableScan <empty>, [customer_id#10, year_total#18]
               +- *(33) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / 2.0))], output=[customer_id#20, year_total#28])
                  +- Exchange hashpartitioning(c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, 200)
                     +- *(32) HashAggregate(keys=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79], functions=[partial_sum(((((ws_ext_list_price#160 - ws_ext_wholesale_cost#159) - ws_ext_discount_amt#157) + ws_ext_sales_price#158) / 2.0))], output=[c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, d_year#79, sum#233])
                        +- *(32) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160, d_year#79]
                           +- *(32) BroadcastHashJoin [ws_sold_date_sk#135], [d_date_sk#73], Inner, BuildRight
                              :- *(32) Project [c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48, ws_sold_date_sk#135, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
                              :  +- *(32) BroadcastHashJoin [c_customer_sk#32], [ws_bill_customer_sk#139], Inner, BuildLeft
                              :     :- ReusedExchange [c_customer_sk#32, c_customer_id#33, c_first_name#40, c_last_name#41, c_preferred_cust_flag#42, c_birth_country#46, c_login#47, c_email_address#48], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
                              :     +- *(32) Project [ws_sold_date_sk#135, ws_bill_customer_sk#139, ws_ext_discount_amt#157, ws_ext_sales_price#158, ws_ext_wholesale_cost#159, ws_ext_list_price#160]
                              :        +- *(32) Filter (isnotnull(ws_bill_customer_sk#139) && isnotnull(ws_sold_date_sk#135))
                              :           +- *(32) FileScan parquet tpcds.web_sales[ws_sold_date_sk#135,ws_bill_customer_sk#139,ws_ext_discount_amt#157,ws_ext_sales_price#158,ws_ext_wholesale_cost#159,ws_ext_list_price#160] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/Users/angela/Desktop/spark-2.4.8-bin-hadoop2.7/spark-warehouse/tpcds.db/w..., PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_ext_discount_amt:double,ws_ext_sales_price:...
                              +- ReusedExchange [d_date_sk#73, d_year#79], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
Time taken: 6.818 seconds, Fetched 1 row(s)
Error in query: 
mismatched input '<EOF>' expecting {'(', 'SELECT', 'FROM', 'ADD', 'DESC', 'WITH', 'VALUES', 'CREATE', 'TABLE', 'INSERT', 'DELETE', 'DESCRIBE', 'EXPLAIN', 'SHOW', 'USE', 'DROP', 'ALTER', 'MAP', 'SET', 'RESET', 'START', 'COMMIT', 'ROLLBACK', 'REDUCE', 'REFRESH', 'CLEAR', 'CACHE', 'UNCACHE', 'DFS', 'TRUNCATE', 'ANALYZE', 'LIST', 'REVOKE', 'GRANT', 'LOCK', 'UNLOCK', 'MSCK', 'EXPORT', 'IMPORT', 'LOAD'}(line 2, pos 52)

== SQL ==

-- end query 4 in stream 0 using template query4.tpl
----------------------------------------------------^^^

